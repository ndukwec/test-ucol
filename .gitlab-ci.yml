variables:
  IMAGE_TAG: $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
stages:
  - build-image
  - test
  - deploy

build-image:
  image: docker:latest
  stage: build-image
  services:
    - docker:dind
  tags:
    - docker

  script:
    - export
    - docker build -t $IMAGE_TAG .
    # - docker login -u  -p # auth to container registry
    # - docker push $IMAGE_TAG

# student tests
# also each job can have a before and after script
student test:
  stage: test
  script: # here we'll specify our actual test script
    # e.g - python manage.py test for a Django application.
    # In our case we can test the id_func function we have in the python script included with python3 -m unittest testingidentityfunc.py
      - python3 -m unittest testingidentityfunc.py
  allow_failure: false

# closed tests
closed test:
  stage: test
  image: python:3.7-alpine
  script:
    - python3 -m unittest closedtest.py
  allow_failure: false

deploy:
  stage: deploy
  image: # Here we specify the image we wish to deploy
  script:
    - echo "trying to deploy"